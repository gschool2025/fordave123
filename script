
Script 20241011
-- Fact table

SELECT [ID_TIME_FK]

      ,[ID_REGION_FK]

      ,[ID_VARIABLE_FK]

      ,[ID_MEASURE_FK]

      ,[VALUE]

  FROM [DW_S4220].[dbo].[Source$]

-- Dimension Table TIME

SELECT DISTINCT [ID_TIME_PK]

      ,[YEAR]

      ,[MONTH]

      ,[MONTH_NAME]

      ,[QUARTER]

      ,[QUARTER_NAME]

      ,[DAY]

      ,[WEEKEND]

      ,[DAY_OF_WEEK]

      ,[DAY_OF_WEEK_NAME]

	  INTO TIME_DIM

  FROM [DW_S4220].[dbo].[Source$]

-- Dimension table MEASURE

SELECT DISTINCT [ID_MEASURE_PK]

      ,[MEASURE_NAME]

      ,[MEASURE_SYMBOL]

      ,[MEASURE_DESCRIPTION]

      ,[MEASURE_MULTIPLIER]

	  INTO MEASURE_DIM

  FROM [DW_S4220].[dbo].[Source$]

-- Dimension table REGION

SELECT DISTINCT [ID_REGION_PK]

      ,[REGION_NAME]

      ,[VOIVODSHIP]

	  INTO REGION_DIM

  FROM [DW_S4220].[dbo].[Source$]

-- Dimension table VARIABLE

SELECT DISTINCT [ID_VARIABLE_PK]

      ,[VARIABLE_NAME]

      ,[VARIABLE_TYPE]

      ,[VARIABLE_DESCRIPTION]

	  INTO VARIABLE_DIM

  FROM [DW_S4220].[dbo].[Source$]





  -- Task 2. Put the keys on the dimension tables.

  -- change the column to not-nullable

  ALTER TABLE MEASURE_DIM ALTER COLUMN ID_MEASURE_PK FLOAT NOT NULL

  GO -- GO IS TO EXECUTE THE PREVIOUS LINE BEFORE GOING TO THE NEXT LINE

  ALTER TABLE MEASURE_DIM ADD PRIMARY KEY (ID_MEASURE_PK)

  GO

  ALTER TABLE REGION_DIM ALTER COLUMN ID_REGION_PK FLOAT NOT NULL

  GO -- GO IS TO EXECUTE THE PREVIOUS LINE BEFORE GOING TO THE NEXT LINE

  ALTER TABLE REGION_DIM ADD PRIMARY KEY (ID_REGION_PK)

  GO

  ALTER TABLE TIME_DIM ALTER COLUMN ID_TIME_PK FLOAT NOT NULL

  GO -- GO IS TO EXECUTE THE PREVIOUS LINE BEFORE GOING TO THE NEXT LINE

  ALTER TABLE TIME_DIM ADD PRIMARY KEY (ID_TIME_PK)

  GO

  ALTER TABLE VARIABLE_DIM ALTER COLUMN ID_VARIABLE_PK FLOAT NOT NULL

  GO -- GO IS TO EXECUTE THE PREVIOUS LINE BEFORE GOING TO THE NEXT LINE

  ALTER TABLE VARIABLE_DIM ADD PRIMARY KEY (ID_VARIABLE_PK)

  GO



  -- Task 3. Create a fact table.

  CREATE TABLE TFACT (

  ID_TIME_FK FLOAT FOREIGN KEY (ID_TIME_FK) REFERENCES TIME_DIM(ID_TIME_PK),

  ID_REGION_FK FLOAT FOREIGN KEY (ID_REGION_FK) REFERENCES REGION_DIM(ID_REGION_PK),

  ID_VARIABLE_FK FLOAT FOREIGN KEY (ID_VARIABLE_FK) REFERENCES VARIABLE_DIM(ID_VARIABLE_PK),

  ID_MEASURE_FK FLOAT FOREIGN KEY (ID_MEASURE_FK) REFERENCES MEASURE_DIM(ID_MEASURE_PK),

  VALUE FLOAT)

  GO
